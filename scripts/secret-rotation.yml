# Secret Rotation Configuration
# Defines automatic rotation policies for production secrets

name: "mariia-production-secrets"
version: "1.0.0"
environment: "production"

# Rotation Schedule (in days)
rotation_schedule:
  daily_secrets: 1    # API keys, tokens
  weekly_secrets: 7    # Database passwords
  monthly_secrets: 30  # Service account keys
  quarterly_secrets: 90 # Root certificates
  annual_secrets: 365  # Long-term encryption keys

# Secret Definitions
secrets:
  database_credentials:
    type: "password"
    rotation: "weekly"
    length: 32
    special_chars: true
    service: "aws-secrets-manager"
    secret_id: "mariia/production/database"
    rotation_lambda: "arn:aws:lambda:eu-west-1:123456789012:function:mariia-rotate-db-creds"
    auto_apply: true
    notification_channels: ["slack", "email"]

  redis_auth_token:
    type: "password"
    rotation: "monthly"
    length: 64
    special_chars: true
    service: "aws-secrets-manager"
    secret_id: "mariia/production/redis"
    rotation_lambda: "arn:aws:lambda:eu-west-1:123456789012:function:mariia-rotate-redis-auth"
    auto_apply: true
    requires_restart: true

  jwt_secrets:
    type: "encryption_key"
    rotation: "quarterly"
    length: 256
    encoding: "base64"
    service: "aws-kms"
    key_id: "alias/mariia-production-jwt"
    rotation_policy: "automatic"
    notification_channels: ["slack"]

  stripe_keys:
    type: "api_key"
    rotation: "monthly"
    service: "stripe"
    requires_manual_approval: true
    rollback_enabled: true
    notification_channels: ["slack", "email", "pagerduty"]

  supabase_keys:
    type: "api_key"
    rotation: "monthly"
    service: "supabase"
    requires_manual_approval: true
    webhook_url: "https://api.supabase.io/hooks/rotation"
    rollback_enabled: true

  email_service_keys:
    type: "api_key"
    rotation: "monthly"
    service: "sendgrid"
    auto_apply: false
    notification_channels: ["email"]

  sms_service_tokens:
    type: "api_key"
    rotation: "monthly"
    service: "twilio"
    auto_apply: false
    notification_channels: ["slack"]

  cdn_certificates:
    type: "certificate"
    rotation: "quarterly"
    service: "aws-acm"
    auto_apply: true
    requires_validation: true
    notification_channels: ["email"]

  backup_encryption_keys:
    type: "encryption_key"
    rotation: "annual"
    service: "aws-kms"
    key_id: "alias/mariia-backup-encryption"
    auto_apply: false
    requires_manual_approval: true
    notification_channels: ["slack", "email", "pagerduty"]

# Notification Configuration
notifications:
  slack:
    webhook_url: "USE_KMS_MANAGED_WEBHOOK_URL"
    channel: "#infrastructure-alerts"
    username: "SecretRotationBot"
    icon_emoji: ":lock:"

  email:
    smtp_server: "smtp.sendgrid.net"
    smtp_port: 587
    from_address: "noreply@mariia.pl"
    to_addresses:
      - "devops@mariia.pl"
      - "security@mariia.pl"

  pagerduty:
    integration_key: "USE_KMS_MANAGED_PAGERDUTY_KEY"
    severity: "warning"

# Compliance and Audit
compliance:
  audit_log_enabled: true
  audit_log_retention_days: 2555  # 7 years
  rotation_approval_required: true
  approval_role: "arn:aws:iam::123456789012:role/SecurityApproval"
  backup_before_rotation: true
  rollback_window_hours: 24

# Health Checks
health_checks:
  post_rotation_validation: true
  service_connectivity_test: true
  application_restart_verification: true
  performance_impact_monitoring: true

# Rollback Configuration
rollback:
  automatic_rollback: true
  rollback_triggers:
    - "application_error_rate > 5%"
    - "response_time_p95 > 2000ms"
    - "authentication_failure_rate > 1%"
  rollback_notification_channels: ["slack", "email", "pagerduty"]
  max_rollback_attempts: 3

# Integration Configuration
integrations:
  aws_secrets_manager:
    region: "eu-west-1"
    kms_key_id: "arn:aws:kms:eu-west-1:123456789012:key/12345678-1234-1234-1234-123456789012"

  aws_kms:
    region: "eu-west-1"
    key_rotation_enabled: true

  github_secrets:
    organization: "mariia-hub"
    repository: "mariia-platform"
    environments:
      - "production"
      - "staging"

  kubernetes_secrets:
    cluster: "mariia-production-cluster"
    namespace: "mariia-platform"
    auto_update_secrets: true
    restart_pods_on_update: true